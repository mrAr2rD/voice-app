<% content_for :page_title, "Новая публикация" %>

<div class="max-w-2xl mx-auto animate-fade-in">
  <div class="rounded-2xl p-8" style="background: var(--color-abyss); border: 1px solid var(--color-graphite);">
    <%= form_with model: @scheduled_post, class: "space-y-6" do |f| %>
      <% if @scheduled_post.errors.any? %>
        <div class="rounded-xl p-4" style="background: rgba(255, 55, 95, 0.1); border: 1px solid rgba(255, 55, 95, 0.2);">
          <ul class="text-sm space-y-1" style="color: var(--color-coral);">
            <% @scheduled_post.errors.full_messages.each do |message| %>
              <li><%= message %></li>
            <% end %>
          </ul>
        </div>
      <% end %>

      <% if @social_accounts.empty? %>
        <div class="rounded-xl p-4" style="background: rgba(255, 159, 10, 0.1); border: 1px solid rgba(255, 159, 10, 0.2);">
          <p style="color: var(--color-warning);">
            Сначала подключите хотя бы один аккаунт в
            <%= link_to "настройках", social_accounts_path, style: "text-decoration: underline;" %>
          </p>
        </div>
      <% end %>

      <!-- Platform -->
      <div>
        <%= f.label :platform, class: "block text-sm font-medium mb-2", style: "color: var(--color-cloud);" do %>
          Платформа
        <% end %>
        <%= f.select :platform,
            @social_accounts.map { |a| [a.account_name || a.platform_name, a.platform] },
            { include_blank: "Выберите платформу" },
            class: "w-full px-4 py-3 rounded-xl appearance-none cursor-pointer",
            style: "background: var(--color-obsidian); border: 1px solid var(--color-graphite); color: var(--color-snow);" %>
      </div>

      <!-- Video Source -->
      <div>
        <label class="block text-sm font-medium mb-2" style="color: var(--color-cloud);">Видео</label>

        <% if @video_builders.any? || @video_clips.any? %>
          <select name="scheduled_post[video_builder_id]"
                  class="w-full px-4 py-3 rounded-xl appearance-none cursor-pointer mb-2"
                  style="background: var(--color-obsidian); border: 1px solid var(--color-graphite); color: var(--color-snow);">
            <option value="">Выберите видео</option>
            <% @video_builders.each do |vb| %>
              <option value="<%= vb.id %>"><%= vb.title %> (VideoBuilder)</option>
            <% end %>
          </select>

          <% if @video_clips.any? %>
            <select name="scheduled_post[video_clip_id]"
                    class="w-full px-4 py-3 rounded-xl appearance-none cursor-pointer"
                    style="background: var(--color-obsidian); border: 1px solid var(--color-graphite); color: var(--color-snow);">
              <option value="">Или выберите клип</option>
              <% @video_clips.each do |vc| %>
                <option value="<%= vc.id %>"><%= vc.display_title %> (Клип)</option>
              <% end %>
            </select>
          <% end %>
        <% else %>
          <p style="color: var(--color-mist);">Нет готовых видео для публикации</p>
        <% end %>
      </div>

      <!-- Caption -->
      <div>
        <%= f.label :caption, class: "block text-sm font-medium mb-2", style: "color: var(--color-cloud);" do %>
          Подпись
        <% end %>
        <%= f.text_area :caption, rows: 4,
            placeholder: "Добавьте описание к видео...",
            class: "w-full px-4 py-3 rounded-xl resize-none",
            style: "background: var(--color-obsidian); border: 1px solid var(--color-graphite); color: var(--color-snow);" %>
      </div>

      <!-- Hashtags -->
      <div>
        <%= f.label :hashtags, class: "block text-sm font-medium mb-2", style: "color: var(--color-cloud);" do %>
          Хэштеги
        <% end %>
        <%= f.text_field :hashtags,
            placeholder: "#видео #контент #новинка",
            class: "w-full px-4 py-3 rounded-xl",
            style: "background: var(--color-obsidian); border: 1px solid var(--color-graphite); color: var(--color-snow);" %>
      </div>

      <!-- Schedule -->
      <div>
        <%= f.label :scheduled_at, class: "block text-sm font-medium mb-2", style: "color: var(--color-cloud);" do %>
          Время публикации <span style="color: var(--color-mist);">(опционально)</span>
        <% end %>
        <%= f.datetime_local_field :scheduled_at,
            class: "w-full px-4 py-3 rounded-xl",
            style: "background: var(--color-obsidian); border: 1px solid var(--color-graphite); color: var(--color-snow);" %>
        <p class="mt-1 text-xs" style="color: var(--color-mist);">Оставьте пустым для немедленной публикации</p>
      </div>

      <!-- Submit -->
      <%= f.submit "Запланировать публикацию",
          class: "w-full py-4 rounded-xl font-semibold text-lg transition-all duration-300 hover:scale-[1.02] cursor-pointer",
          style: "background: linear-gradient(135deg, var(--color-neon-purple) 0%, var(--color-neon-pink) 100%); color: white;" %>
    <% end %>
  </div>
</div>

<% content_for :page_title, "Новая транскрибация" %>

<div class="max-w-2xl mx-auto animate-fade-in">

  <!-- Form Card -->
  <div class="rounded-2xl p-8" style="background: var(--color-abyss); border: 1px solid var(--color-graphite);">
    <%= form_with model: @transcription, class: "space-y-6", data: { controller: "tabs dropzone" } do |f| %>
      <% if @transcription.errors.any? %>
        <div class="rounded-xl p-4" style="background: rgba(255, 107, 107, 0.1); border: 1px solid rgba(255, 107, 107, 0.2);">
          <ul class="text-sm space-y-1" style="color: var(--color-coral);">
            <% @transcription.errors.full_messages.each do |message| %>
              <li class="flex items-center">
                <svg class="w-4 h-4 mr-2 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                <%= message %>
              </li>
            <% end %>
          </ul>
        </div>
      <% end %>

      <!-- Title -->
      <div>
        <%= f.label :title, class: "block text-sm font-medium mb-2", style: "color: var(--color-cloud);" do %>
          Название <span style="color: var(--color-mist);">(опционально)</span>
        <% end %>
        <%= f.text_field :title, placeholder: "Название для транскрибации",
            class: "w-full px-4 py-3 rounded-xl transition-all duration-200 focus:outline-none",
            style: "background: var(--color-obsidian); border: 1px solid var(--color-graphite); color: var(--color-snow);" %>
      </div>

      <!-- Tabs -->
      <div class="rounded-xl p-1" style="background: var(--color-obsidian);" data-tabs-target="nav">
        <div class="flex">
          <button type="button" data-action="click->tabs#switch" data-tab="file"
                  class="tab-button flex-1 py-3 px-4 rounded-lg text-sm font-medium transition-all duration-200"
                  style="background: var(--color-graphite); color: var(--color-snow);">
            <svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
            </svg>
            Загрузить файл
          </button>
          <button type="button" data-action="click->tabs#switch" data-tab="youtube"
                  class="tab-button flex-1 py-3 px-4 rounded-lg text-sm font-medium transition-all duration-200"
                  style="color: var(--color-mist);">
            <svg class="w-5 h-5 inline mr-2" fill="currentColor" viewBox="0 0 24 24">
              <path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/>
            </svg>
            YouTube
          </button>
        </div>
      </div>

      <!-- File Upload Panel -->
      <div data-tabs-target="panel" data-tab="file">
        <div class="rounded-xl p-8 text-center transition-all duration-300 cursor-pointer group"
             style="border: 2px dashed var(--color-slate); background: var(--color-obsidian);"
             data-dropzone-target="zone"
             data-action="dragover->dropzone#dragover dragenter->dropzone#dragenter dragleave->dropzone#dragleave drop->dropzone#drop click->dropzone#click">
          <div class="w-16 h-16 rounded-2xl flex items-center justify-center mx-auto mb-4 transition-all duration-300 group-hover:scale-110"
               style="background: rgba(0, 212, 255, 0.1);">
            <svg class="w-8 h-8" style="color: var(--color-neon-blue);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"/>
            </svg>
          </div>
          <p class="text-sm mb-1" style="color: var(--color-cloud);">
            Перетащите файл сюда или
            <label class="cursor-pointer transition-colors" style="color: var(--color-neon-blue);">
              выберите файл
              <%= f.file_field :source_file, accept: "audio/*,video/*,.mp3,.wav,.ogg,.m4a,.flac,.webm,.mp4,.mov,.avi,.mkv",
                  class: "hidden", data: { dropzone_target: "input", action: "change->dropzone#change" } %>
            </label>
          </p>
          <p class="text-xs" style="color: var(--color-mist);">MP3, WAV, OGG, M4A, FLAC, MP4, WebM, MOV, AVI до 500MB</p>
          <p class="mt-4 text-sm font-medium hidden" style="color: var(--color-neon-green);" data-dropzone-target="filename"></p>
        </div>
      </div>

      <!-- YouTube Panel -->
      <div data-tabs-target="panel" data-tab="youtube" class="hidden">
        <%= f.label :youtube_url, class: "block text-sm font-medium mb-2", style: "color: var(--color-cloud);" do %>
          YouTube URL
        <% end %>
        <div class="relative">
          <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none">
            <svg class="w-5 h-5" style="color: var(--color-mist);" fill="currentColor" viewBox="0 0 24 24">
              <path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/>
            </svg>
          </div>
          <%= f.url_field :youtube_url, placeholder: "https://www.youtube.com/watch?v=...",
              class: "w-full pl-12 pr-4 py-3 rounded-xl transition-all duration-200 focus:outline-none",
              style: "background: var(--color-obsidian); border: 1px solid var(--color-graphite); color: var(--color-snow);" %>
        </div>
        <p class="mt-2 text-xs" style="color: var(--color-mist);">Поддерживаются ссылки youtube.com и youtu.be</p>
      </div>

      <!-- Language -->
      <div>
        <%= f.label :language, class: "block text-sm font-medium mb-2", style: "color: var(--color-cloud);" do %>
          Язык <span style="color: var(--color-mist);">(опционально)</span>
        <% end %>
        <%= f.select :language, options_for_select([
            ["Автоопределение", ""],
            ["Русский", "ru"],
            ["Английский", "en"],
            ["Немецкий", "de"],
            ["Французский", "fr"],
            ["Испанский", "es"],
            ["Итальянский", "it"],
            ["Португальский", "pt"],
            ["Китайский", "zh"],
            ["Японский", "ja"],
            ["Корейский", "ko"]
        ]),
            {},
            class: "w-full px-4 py-3 rounded-xl transition-all duration-200 focus:outline-none appearance-none cursor-pointer",
            style: "background: var(--color-obsidian); border: 1px solid var(--color-graphite); color: var(--color-snow);" %>
      </div>

      <!-- Submit -->
      <%= f.submit "Начать транскрибацию",
          class: "w-full py-4 rounded-xl font-semibold text-lg transition-all duration-300 hover:scale-[1.02] cursor-pointer",
          style: "background: var(--gradient-aurora); color: var(--color-void); box-shadow: 0 10px 40px rgba(0, 212, 255, 0.3);" %>
    <% end %>
  </div>

</div>

<style>
  .tab-button[data-tab].active {
    background: var(--color-graphite) !important;
    color: var(--color-snow) !important;
  }
</style>
